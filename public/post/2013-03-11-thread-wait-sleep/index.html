<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title> Thread wait 和 sleep &middot; Tachikoma blog </title>

  
  <link rel="stylesheet" href="http://ikarishinjieva.github.io/tachikoma-blog/css/poole.css">
  <link rel="stylesheet" href="http://ikarishinjieva.github.io/tachikoma-blog/css/syntax.css">
  <link rel="stylesheet" href="http://ikarishinjieva.github.io/tachikoma-blog/css/hyde.css">
  <link rel="stylesheet" href="http://ikarishinjieva.github.io/tachikoma-blog/css/tachikoma.css">
  <link rel="stylesheet" href="http://fonts.useso.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.ico">

  
  <link href="" rel="alternate" type="application/rss+xml" title="Tachikoma blog" />
</head>

<body>

<div style="position: fixed;bottom: 0px;right:0px;">
<img src="http://ikarishinjieva.github.io/tachikoma-blog/tachikoma.gif" style="opacity:0.7; filter:alpha(opacity=70);"/>
</div>
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h2 style="color:rgba(255,255,255,.5)">Tachikoma blog</h2>
      <p class="lead">
        <a href="mailto:tac.nil@outlook.com">Email</a> |
        <a href="http://weibo.com/u/1460219211">Weibo</a> |
        <a href="https://github.com/ikarishinjieva">Github</a>
      </p>
    </div>
<hr>
    <ul class="sidebar-nav">
      <li><a href="http://ikarishinjieva.github.io/tachikoma-blog/">Home</a> </li>
      <li><a href="http://ikarishinjieva.github.io/tachikoma-blog/tags">Tags</a> </li>
      
    </ul>

  </div>
</div>


<div class="content container">
<div class="post">
  <h1>Thread wait 和 sleep</h1>
  <span class="post-date">Mon, Mar 11, 2013      
  	<ul style="float:right; " class="post-tags">
      
        <li><a href="tags/concurrency">concurrency</a> </li>
      
        <li><a href="tags/workspace">workspace</a> </li>
      
    </ul></span>
      <p>ifeve上发现几个多线程的<a href="http://ifeve.com/javaconcurrency-interview-questions-base/">基础问题</a>。我一直不写多线程（我这两年到底都写了些什么~），重头学起。</p>

<p>sleep和wait的区别。sleep让出cpu，等一段时间，重新进入竞争，不释放锁。wait等一个状态notify，才重新进入竞争，但释放锁。</p>

<p>下面代码说明是否释放锁的区别：</p>

<p>sleep不会释放锁</p>

<pre><code>import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;
import java.util.concurrent.TimeUnit;

public class MultiThread {
    public static class T1 extends Thread {
        @Override
        public void run() {
            synchronized (MultiThread.class) {
                System.out.println(&quot;T1 run&quot;);
                System.out.println(&quot;T1 sleep&quot;);
                try {
                    sleep(10000);
                } catch (InterruptedException e) {
                    throw new RuntimeException(e);
                }
                System.out.println(&quot;T1 wake up&quot;);
            }
        }
    }
    
    public static class T2 extends Thread {
        @Override
        public void run() {
            synchronized (MultiThread.class) {
                System.out.println(&quot;T2 run&quot;);
            }
        }
    }

    public static void main(final String[] args) throws InterruptedException {
        ExecutorService executorService = Executors.newFixedThreadPool(2);
        executorService.execute(new T1());
        Thread.sleep(1000);
        executorService.execute(new T2());
        
        //dispose
        executorService.awaitTermination(1, TimeUnit.HOURS);
    }
}
</code></pre>

<p>wait会释放锁</p>

<pre><code>import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;
import java.util.concurrent.TimeUnit;

public class MultiThread2 {
    public static class T1 extends Thread {
        @Override
        public void run() {
            synchronized (MultiThread2.class) {
                System.out.println(&quot;T1 run&quot;);
                System.out.println(&quot;T1 wait&quot;);
                try {
                    MultiThread2.class.wait();
                } catch (InterruptedException e) {
                    throw new RuntimeException(e);
                }
                System.out.println(&quot;T1 wake up&quot;);
            }
        }
    }
    
    public static class T2 extends Thread {
        @Override
        public void run() {
            synchronized (MultiThread2.class) {
                System.out.println(&quot;T2 run&quot;);
            }
        }
    }

    public static void main(final String[] args) throws InterruptedException {
        ExecutorService executorService = Executors.newFixedThreadPool(2);
        executorService.execute(new T1());
        Thread.sleep(1000);
        executorService.execute(new T2());
        
        //dispose
        Thread.sleep(10000);
        synchronized (MultiThread2.class) {
            MultiThread2.class.notify();
        }
        executorService.awaitTermination(1, TimeUnit.HOURS);
    }
}
</code></pre>

<p>sleep的执行结果是T1 run, T1 sleep, T1 wake up, T2 run</p>

<p>wait的执行结果是T1 run, T1 wait, T2 run (此处锁被释放, T2获得锁), T1 wake up</p>

</div>
  <div id="disqus_thread"></div>
  <script type="text/javascript">
       
      var disqus_shortname = 'tacsay'; 

       
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  
</div>

  </body>
</html>
